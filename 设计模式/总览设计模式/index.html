

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="../../img/fluid.png">
  <link rel="icon" href="../../img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="NoahArno">
  <meta name="keywords" content="">
  
    <meta name="description" content="第零章 总览 设计模式的七大原则  开闭原则（Open Closed Principle）：软件实体应当对扩展开放，对修改关闭（Software entities should be open for extension, but closed for modification）；合成复用原则、里氏替换原则相辅相成，都是开闭原则的具体实现规范；扩展新类而不是修改旧类 里氏替换原则（Liskov S">
<meta property="og:type" content="article">
<meta property="og:title" content="总览设计模式">
<meta property="og:url" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="NoahArno">
<meta property="og:description" content="第零章 总览 设计模式的七大原则  开闭原则（Open Closed Principle）：软件实体应当对扩展开放，对修改关闭（Software entities should be open for extension, but closed for modification）；合成复用原则、里氏替换原则相辅相成，都是开闭原则的具体实现规范；扩展新类而不是修改旧类 里氏替换原则（Liskov S">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219120505207.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219203456018.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219203608238.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219204303827.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219204813862.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219211043722.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219215034009.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211220091933738.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211220105640201.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221115100969.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221115249590.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221121625676.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221122333684.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221124450298.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221124858117.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221125524010.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221130132252.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221131311183.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221131950615.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221135327385.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221140524951.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221141517304.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221141857171.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221142741832.png">
<meta property="og:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221143204328.png">
<meta property="article:published_time" content="2023-04-06T15:09:48.000Z">
<meta property="article:modified_time" content="2023-04-06T17:09:05.299Z">
<meta property="article:author" content="NoahArno">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://noaharno.top/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219120505207.png">
  
  
  
  <title>总览设计模式 - NoahArno</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="../../css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="../../css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="../../css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"noaharno.top","root":"/","version":"1.9.4","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="../../js/utils.js" ></script>
  <script  src="../../js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="../../index.html">
      <strong>NoahArno</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../index.html">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('../../img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">总览设计模式</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-06 23:09" pubdate>
          2023年4月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          34k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          286 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">总览设计模式</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="第零章-总览"><a href="#第零章-总览" class="headerlink" title="第零章 总览"></a>第零章 总览</h2><p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219120505207.png" srcset="/img/loading.gif" lazyload alt="image-20211219120505207"></p>
<p><strong>设计模式的七大原则</strong></p>
<ol>
<li>开闭原则（Open Closed Principle）：软件实体应当对扩展开放，对修改关闭（Software entities should be open for extension, but closed for modification）；合成复用原则、里氏替换原则相辅相成，都是开闭原则的具体实现规范；<strong>扩展新类而不是修改旧类</strong></li>
<li>里氏替换原则（Liskov Substitution Principle）：继承必须确保超类所拥有的性质在子类中仍然成立（Inheritance should ensure that any property proved about supertype objects also holds for subtype objects）；<strong>继承父类而不去改变父类</strong></li>
<li>合成复用原则（Composite Reuse Principle）：又叫组合&#x2F;聚合复用原则（Composition&#x2F;Aggregate Reuse Principle）；软件复用时，要尽量先使用组合或者聚合等关联关系来实现，其次才考虑使用继承关系来实现；<strong>优先组合，其次继承</strong></li>
<li>迪米特法则（Law of Demeter）：最少知识原则（Least Knowledge Principle）；只跟你的直接朋友交谈，不跟陌生人说话（Talk only to your immediate friends and not to strangers）；<strong>无需直接交互的两个类，如果需要交互，使用中间者</strong>；过度使用迪米特法则会使系统产生大量的中介类，从而增加系统的复杂性，使模块之间的通信效率降低</li>
<li>接口隔离原则（Interface Segregation Principle）：一个类对另一个类的依赖应该建立在最小的接口上（The dependency of one class to another one should depend on the smallest possible interface）；<strong>各个类建立自己的专用接口，而不是建立万能接口</strong></li>
<li>依赖倒置原则（Dependence Inversion Principle）：高层模块不应该依赖底层模块，两者都应该依赖其抽象；抽象不应该依赖细节，细节应该依赖抽象（High level modules shouldnot depend upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions）；<strong>面向接口编程，而不是面向实现类</strong></li>
<li>单一职责原则（Single Responsibility Principle）：一个类应该有且仅有一个引起它变化的原因，否则类应该被拆分（There should never be more than one reason for a class to change）；<strong>每个类只负责自己的事情，而不是变成万能</strong></li>
</ol>
<h2 id="第一章-创建型模式"><a href="#第一章-创建型模式" class="headerlink" title="第一章 创建型模式"></a>第一章 创建型模式</h2><p><strong>为什么用创建型模式？</strong></p>
<ul>
<li>创建型模式关注点<strong>怎样创建出对象</strong></li>
<li><strong>将对象的创建与使用分离</strong></li>
<li>降低系统的耦合度</li>
<li>使用者无需关注对象的创建细节<ul>
<li>对象的创建由相关的工厂来完成：工厂模式</li>
<li>对象的创建由一个建造者来完成：建造者模式</li>
<li>对象的创建由原来对象克隆完成：原型模式</li>
<li>对象始终在系统中只有一个实例：单例模式</li>
</ul>
</li>
</ul>
<h3 id="1-1-单例（Singleton）模式"><a href="#1-1-单例（Singleton）模式" class="headerlink" title="1.1 单例（Singleton）模式"></a>1.1 单例（Singleton）模式</h3><p>一个单一的类，负责创建自己的对象，同时确保系统中只有单个对象被创建。</p>
<p>单例特点：</p>
<ul>
<li>某个类只能有一个实例：构造器私有</li>
<li>它必须自行创建这个实例：自己编写实例化逻辑</li>
<li>它必须自行向整个系统提供这个实例：对外提供实例化方法</li>
</ul>
<p>应用场景：</p>
<ul>
<li>多线程中的线程池</li>
<li>数据库中的连接池</li>
<li>系统环境信息</li>
<li>上下文（ServletContext）</li>
<li>…</li>
</ul>
<p>面试问题：</p>
<ul>
<li>系统环境信息（System.getProperties()）？</li>
<li>Spring中怎么保持组件单例的</li>
<li>ServletContext是什么？是单例吗？怎么保证的？</li>
<li>ApplicationContext是什么？</li>
<li>数据库连接池一般是怎么创建出来的，怎么保证单例？</li>
</ul>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Person instance;<br><br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Personn</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 构造器私有化u</span><br>&#125;<br><br><span class="hljs-comment">// 提供给外部的方法</span><br><span class="hljs-comment">// 1、锁加载方法上，但是锁太大，效率低</span><br><span class="hljs-comment">// 2、双重检查锁 + 内存可见性</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Person <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>		<span class="hljs-keyword">synchronized</span> (Person.class) &#123;<br>            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> instance;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-原型（Prototype）模式"><a href="#1-2-原型（Prototype）模式" class="headerlink" title="1.2 原型（Prototype）模式"></a>1.2 原型（Prototype）模式</h3><ol>
<li>原型模式是用于创建重复的对象，同时又能保证性能</li>
<li>本体给外部提供一个克隆体进行使用</li>
<li>使用场景：<ul>
<li>资源优化</li>
<li>性能和安全要求</li>
<li>一个对象多个修改者的场景</li>
<li>一个对象需要提供给其他对象访问，而且各个调用者可能都需要修改其值时可以考虑使用原型模式拷贝多个对象供调用者使用</li>
<li>深拷贝和浅拷贝</li>
</ul>
</li>
</ol>
<p>使用场景模拟：如果我们要自己写一个自己的mybatis框架，考虑到在进行查询的时候，在大多数情况下，我们查询到的数据应该是不怎么改变的。例如，如果我们查询一种商品信息：new Product(“…”)，然后需要查询一千次的话，系统里面就会有一千个内容相同的product对象，浪费内存；</p>
<p>因此就可以使用原型模式来解决，也就是可以使用缓存，将查过的数据进行保存，如果再查相同的数据，就拿到原来的原型对象的克隆对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <br>    <span class="hljs-comment">// 也可以使用其余的更加高效的方式实现克隆</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setUsername(username);<br>        user.setAge(age);<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DLFMybatis</span> &#123;<br>    <span class="hljs-comment">// 缓存user</span><br>    <span class="hljs-keyword">private</span> Map&lt;String, User&gt; userCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (!userCache.containsKey(username)) &#123;<br>            <span class="hljs-comment">// 查询数据库</span><br>            user = getUserFromDb(username);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 从缓存种直接拿数据的话会造成脏缓存问题</span><br>            <span class="hljs-comment">// 拿到原型，但是不能直接给，应该给克隆体</span><br>            user = userCache.get(username);<br>            user = (User) userr.clone();<br>        &#125;<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> User <span class="hljs-title function_">getUserFromDb</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setUsername(username);<br>        <span class="hljs-comment">// 给缓存中放一个clone，不然第一次查询数据库的时候返回的对象是原型</span><br>        userCache.put(username, (User) user.clone());<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-工厂（Factory）模式"><a href="#1-3-工厂（Factory）模式" class="headerlink" title="1.3 工厂（Factory）模式"></a>1.3 工厂（Factory）模式</h3><p>工厂模式提供了一种创建对象的最佳方式。我们不必关系对象的创建细节，只需要根据不同情况获取不同产品即可。</p>
<p>应用场景：</p>
<ul>
<li>NumberFormat、SimpleDateFormat</li>
<li>LoggerFactory</li>
<li>SqlSessionFactory</li>
<li>BeanFactory：Spring中的，就是为了造出bean</li>
</ul>
<h4 id="1-3-1-简单工厂（Simple-Factory）"><a href="#1-3-1-简单工厂（Simple-Factory）" class="headerlink" title="1.3.1 简单工厂（Simple Factory）"></a>1.3.1 简单工厂（Simple Factory）</h4><p>比如我们有一个能生产van和mini两种车的工厂，就可以通过这个工厂来创建对应的类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type  如果使用Class进行反射: 好像具有扩展性，但是没有解决实际问题</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><span class="hljs-keyword">public</span> AbstractCar <span class="hljs-title function_">newCar</span><span class="hljs-params">(String type)</span>&#123;<br><br>    <span class="hljs-comment">//核心方法：一切从简</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;van&quot;</span>.equals(type))&#123;<br>        <span class="hljs-comment">// 如果后续还得用钣金、喷漆、放发动机、申请环保，因此class也不太好使</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VanCar</span>();<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;mini&quot;</span>.equals(type))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCar</span>();<br>    &#125;<br><br>    <span class="hljs-comment">//.....</span><br><br>    <span class="hljs-comment">//更多的产品，违反开闭原则。应该直接扩展出一个类来造</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219203456018.png" srcset="/img/loading.gif" lazyload alt="image-20211219203456018"></p>
<p>缺点：违背开闭，扩展不易；如果想要该工厂创建更多的类，就得不停的使用if和else</p>
<h4 id="1-3-2-工厂方法（Factory-Method）"><a href="#1-3-2-工厂方法（Factory-Method）" class="headerlink" title="1.3.2 工厂方法（Factory Method）"></a>1.3.2 工厂方法（Factory Method）</h4><p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219203608238.png" srcset="/img/loading.gif" lazyload alt="image-20211219203608238"></p>
<p>如图所示，我们可以将工厂给抽象出来，然后给每种类都分别创建一个单独的工厂，这样扩展性增加。</p>
<p>缺点：系统复杂度增加，产品单一。每想要增加一个类，就得多一个工厂。</p>
<h4 id="1-3-3-抽象工厂（Abstract-Factory）"><a href="#1-3-3-抽象工厂（Abstract-Factory）" class="headerlink" title="1.3.3 抽象工厂（Abstract Factory）"></a>1.3.3 抽象工厂（Abstract Factory）</h4><p>如果我们想要生产手机、汽车、口罩等等，而且手机有小米手机、华为手机等，汽车有货车、私家车等。</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219204303827.png" srcset="/img/loading.gif" lazyload alt="image-20211219204303827"></p>
<p>其实还可以进行抽象，WuLinFactory下面有WulinMaskFactory和WulinCarFactory，然后每种工厂都生产各自的东西。</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219204813862.png" srcset="/img/loading.gif" lazyload alt="image-20211219204813862"></p>
<p><strong>工厂模式的退化</strong></p>
<p>当抽象工厂模式中的<strong>每一个具体工厂类只创建一个产品对象</strong>，也就是只存在一个产品等级结构时，<strong>抽象工厂模式退化成工厂方法模式</strong>；当工厂方法模式中抽象工厂与具体工厂合并，提供一个统一的工厂来创建产品对象，并将创建对象的工厂方法设计为静态方法时，<strong>工厂方法模式退化成简单工厂模式</strong>。</p>
<h3 id="1-4-建造者（Builder）模式"><a href="#1-4-建造者（Builder）模式" class="headerlink" title="1.4 建造者（Builder）模式"></a>1.4 建造者（Builder）模式</h3><p>每一个建造小细节都可以传入，但是都不是必须；<strong>如果是必须，就构造器强制。</strong></p>
<p>创建的东西细节复杂，还必须暴露给使用者。<strong>屏蔽过程而不屏蔽细节</strong></p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219211043722.png" srcset="/img/loading.gif" lazyload alt="image-20211219211043722"></p>
<p>如果我们想要创建手机实例，就可以不通过new Phone的方式创建，而是通实现AbstractPhoneBuilder来创建实例。因为不同种类的手机有不同的实现细节。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 抽象构造者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractBuilder</span> &#123;<br>    Phone phone;<br>    <span class="hljs-keyword">abstract</span> AbstractBuilder <span class="hljs-title function_">customCpu</span><span class="hljs-params">(String cpu)</span>;<br>    <span class="hljs-keyword">abstract</span> AbstractBuilder <span class="hljs-title function_">customMem</span><span class="hljs-params">(String mem)</span>;<br>    <span class="hljs-keyword">abstract</span> AbstractBuilder <span class="hljs-title function_">customDisk</span><span class="hljs-params">(String disk)</span>;<br>    <span class="hljs-keyword">abstract</span> AbstractBuilder <span class="hljs-title function_">customCam</span><span class="hljs-params">(String cam)</span>;<br><br>    <span class="hljs-comment">// 获取创建好的phone</span><br>    <span class="hljs-comment">// 实际上返回的应该是不同的对象</span><br>    Phone <span class="hljs-title function_">getProduct</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> phone;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 具体构造者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoMiBuilder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractBuilder</span> &#123;<br>    <span class="hljs-comment">// 具体的细节暂不考虑，比如通过这个builder返回所有phone都将是同一对象，应该修改</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">XiaoMiBuilder</span><span class="hljs-params">()</span> &#123;<br>        phone = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    AbstractBuilder <span class="hljs-title function_">customCpu</span><span class="hljs-params">(String cpu)</span> &#123;<br>        phone.cpu = cpu;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    AbstractBuilder <span class="hljs-title function_">customMem</span><span class="hljs-params">(String mem)</span> &#123;<br>        phone.mem = mem;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    AbstractBuilder <span class="hljs-title function_">customDisk</span><span class="hljs-params">(String disk)</span> &#123;<br>        phone.disk = disk;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    AbstractBuilder <span class="hljs-title function_">customCam</span><span class="hljs-params">(String cam)</span> &#123;<br>        phone.cam = cam;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AbstractBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoMiBuilder</span>();<br>    <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> builder.customCpu(<span class="hljs-string">&quot;骁龙8个8&quot;</span>)<br>        .customCam(<span class="hljs-string">&quot;2亿&quot;</span>)<br>        .customDisk(<span class="hljs-string">&quot;1T&quot;</span>)<br>        .customMem(<span class="hljs-string">&quot;16G&quot;</span>)<br>        .getProduct();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>值得注意的是，LomBok提供了@Builder注解给我们使用，用的就是建造者模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 加了注解之后就可以直接使用该类.builder()</span><br><span class="hljs-type">Phone</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> Phone.builder()<br>    .cpu(<span class="hljs-string">&quot;1&quot;</span>)<br>    .mem(<span class="hljs-string">&quot;2&quot;</span>)<br>    .cam(<span class="hljs-string">&quot;3&quot;</span>)<br>    .disk(<span class="hljs-string">&quot;4&quot;</span>)<br>    .build();<br></code></pre></td></tr></table></figure>

<p><strong>使用场景</strong>：</p>
<ul>
<li>StringBuilder中的append</li>
<li>Swagger-ApiBuilder</li>
<li>快速实现。LomBok - Builder模式</li>
</ul>
<h2 id="第二章-结构型模式"><a href="#第二章-结构型模式" class="headerlink" title="第二章 结构型模式"></a>第二章 结构型模式</h2><p><strong>为什么使用结构型模式？</strong></p>
<ul>
<li>结构型模式关注点“怎样组合对象&#x2F;类？”，所以我们关注下类的组合关系</li>
<li>类结构型模式关系类的组合，由多个类可以组合成一个更大的（继承）</li>
<li>对象结构模式关系类与对象的组合，通过关联关系在一个类中定义另一个类的实例对象（组合）</li>
<li>根据合成复用原则，在系统中尽量使用关联关系来替代继承关系，因此大部分结构型模式都是对象结构型模式。</li>
</ul>
<p><strong>结构型模式分类</strong></p>
<ul>
<li>适配器模式：两个不兼容接口之间适配的桥梁</li>
<li>桥接模式：相同功能抽象化与实现化解耦，抽象与实现可以独立升级</li>
<li>过滤器模式：使用不同的标准来过滤一组对象</li>
<li>组合模式：相似对象进行组合，形成树形结构</li>
<li>装饰器模式：向一个现有的对象添加新的功能，同时又不改变其结构</li>
<li>外观模式：向现有的系统添加一个接口，客户端访问此接口来隐藏系统的复杂性</li>
<li>享元模式：尝试重用现有的同类对象，如果未找到匹配的对象，则创建新对象</li>
<li>代理模式：一个类代表另一个类的功能</li>
</ul>
<h3 id="2-1-适配器（Adapter）模式"><a href="#2-1-适配器（Adapter）模式" class="headerlink" title="2.1 适配器（Adapter）模式"></a>2.1 适配器（Adapter）模式</h3><p>将一个接口转换成客户希望的另一个接口，适配器模式使接口不兼容的那些类可以一起工作，适配器模式分为类结构型模式（继承）和对象结构型模式（组合）两种，前者（继承）类之间的耦合度比后者高，且要求程序员了解现有组件库中的相关组件的内部结构，所以应用相对较少些。</p>
<p>别名也可以是Wrapper，包装器。</p>
<p>适配器模式包含以下主要角色</p>
<ul>
<li>目标接口：可以是抽象类或接口。客户希望直接用的接口</li>
<li>适配者：隐藏的转换接口</li>
<li>适配器：它是一个转换器，通过继承或引用适配者的对象，把适配者接口转换成目标接口。</li>
</ul>
<p>通俗点就是说，比如我想看英文电影，然后还有一个翻译机。就可以通过通过一个适配器，让英文电影和翻译机联系起来，让我们能看懂英文电影</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211219215034009.png" srcset="/img/loading.gif" lazyload alt="image-20211219215034009"></p>
<p>对象适配器模式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JPMoviePlayerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Player</span> &#123;<br>    <span class="hljs-comment">// 组合的方式</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Translator</span> <span class="hljs-variable">translator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Zh_JPTranslator</span>();<br>    <span class="hljs-keyword">private</span> Player target; <span class="hljs-comment">// 被适配的对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JPMoviePlayerAdapter</span><span class="hljs-params">(Player target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">play</span> <span class="hljs-operator">=</span> target.play();<br>        <span class="hljs-comment">// 转换字母，增强逻辑</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">translate</span> <span class="hljs-operator">=</span> translator.translate(play);<br>        System.out.println(<span class="hljs-string">&quot;日文：&quot;</span> + translate);<br>        <span class="hljs-keyword">return</span> play;<br>    &#125;<br><br>    <span class="hljs-comment">// 测试</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 使用适配器增强player</span><br>        <span class="hljs-type">JPMoviePlayerAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JPMoviePlayerAdapter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MoviePlayer</span>());<br>        adapter.play();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>类适配：Adapter进行实现或者继承</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JPMoviePlayerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Zh_JPTranslator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Player</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Player target;<span class="hljs-comment">//被适配对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JPMoviePlayerAdapter</span><span class="hljs-params">(Player target)</span>&#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">play</span> <span class="hljs-operator">=</span> target.play();<br>        <span class="hljs-comment">//转换字幕</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">translate</span> <span class="hljs-operator">=</span> translate(play);<br>        System.out.println(<span class="hljs-string">&quot;日文：&quot;</span>+translate);<br>        <span class="hljs-keyword">return</span> play;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>使用场景</strong></p>
<ul>
<li>Tomcat如何将Request流转为标准Request？<ul>
<li>tomcat &#x3D;&#x3D;&#x3D; CopyteAdapte &#x3D;&#x3D; ServletRequest</li>
</ul>
</li>
<li>SpringAOP中的AdvisorAdapter是什么：增强的适配器</li>
<li>SpringMVC中经典的HandlerAdapter是什么？<ul>
<li>HelloController.hello()方法，通过HandlerAdapter来调用底层的Servlet.doGet()</li>
</ul>
</li>
<li>SpringBoot中的WebMvcConfigurerAdapter为什么存在又取消？</li>
</ul>
<h3 id="2-2-桥接（Bridge）模式"><a href="#2-2-桥接（Bridge）模式" class="headerlink" title="2.2 桥接（Bridge）模式"></a>2.2 桥接（Bridge）模式</h3><ul>
<li>将抽象与实现解耦，使两者都可以独立变化。</li>
<li>在现实生活中，某些类具有两个或多个维度的变化，如图形即可按形状分，又可按颜色分。如何设计类似于Photoshop这样的软件，能画不同形状和不同颜色的图形呢？如果用继承方式的话，m种形状和n种颜色的图形就有m * n种，不但对应子类很多，而且扩展困难。</li>
<li><strong>桥接将继承转换为关联，降低类之间的耦合度，减少代码量。</strong></li>
<li><strong>真正会引起此类变化的一个维度直接抽取出来，通过组合的方式接起来</strong></li>
</ul>
<p>桥接模式包含以下主要角色：</p>
<ul>
<li>系统设计期间，如果这个类里面的一些东西，会扩展很多，这个东西就应该分离出来</li>
<li>抽象化（Abstraction）角色：定义抽象类，并包含一个对实现化对象的引用。</li>
<li>扩展抽象化（Refined Abstraction）角色：是抽象化角色的子类，实现父类中的业务方法，并通过组合关系调用实现化角色中的业务方法。</li>
<li>实现化（Implementor）角色：定义实现化角色的接口，供扩展抽象化角色调用。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211220091933738.png" srcset="/img/loading.gif" lazyload alt="image-20211220091933738"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>当一个类存在两个独立变化的维度，且这两个维度都需要进行扩展时。</li>
<li>当一个系统不希望使用继承或因为多层次继承导致系统类的个数急剧增加时</li>
<li>当一个系统需要在构件的抽象化角色和具体化角色之间增加更多的灵活性时</li>
<li>InputStreamReader桥接模式。An InputStreamReader is a bridge from byte streams to character streams;</li>
<li>InputStreamReader 桥接+ 适配器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 比如我们的重点是手机，然后手机有小米手机和苹果手机等等</span><br><span class="hljs-comment">// 而每种手机又有线上和线下两种销售模式</span><br><span class="hljs-comment">// 如果不使用桥接模式的话，就需要创建2 * 2个类</span><br><span class="hljs-comment">// 使用了桥接模式 只需要2 + 2个类了。</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractPhone</span> &#123;<br>    <span class="hljs-comment">// 将会引起变化的销售模式给抽取出来</span><br>    AbstractSale sale; <span class="hljs-comment">// 【桥接的关注点】</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSale</span><span class="hljs-params">(AbstractSale sale)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sale = sale;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractSale</span> &#123;<br>    <span class="hljs-keyword">private</span> String type;<br>    <span class="hljs-keyword">private</span> Integer price;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>    <span class="hljs-comment">// AbstractPhone的实现类</span><br>    <span class="hljs-type">IPhone</span> <span class="hljs-variable">iPhone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IPhone</span>();<br>    <span class="hljs-comment">// 销售模式</span><br>    iPhone.setSale(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StudentSale</span>(<span class="hljs-string">&quot;学生&quot;</span>,<span class="hljs-number">1</span>));<br><br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> iPhone.getPhone();<br>    System.out.println(phone);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-装饰器（Decorator-x2F-Wrapper（包装））模式"><a href="#2-3-装饰器（Decorator-x2F-Wrapper（包装））模式" class="headerlink" title="2.3 装饰器（Decorator&#x2F;Wrapper（包装））模式"></a>2.3 装饰器（Decorator&#x2F;Wrapper（包装））模式</h3><ul>
<li>适配器是连接两个类，可以增强一个类；而装饰器是增强一个类</li>
<li>向一个现有的对象添加新的功能，同时又不改变其结构，属于对象结构型模式</li>
<li>创建了一个装饰类，用来包装原有的类，并在保持类方法签名完整性的前提下，提供了额外的功能。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211220105640201.png" srcset="/img/loading.gif" lazyload alt="image-20211220105640201"></p>
<ul>
<li>抽象构件（Component）角色：定义一个抽象接口以规范准备接收附加责任的对象</li>
<li>具体构建（ConcreteComponent）角色：实现抽象构件，通过装饰角色为其添加一些职责</li>
<li>抽象装饰（Decorator）角色：继承抽象构件，并包含具体构件的实例，可以通过其子类扩展具体构件的功能。</li>
<li>具体装饰（ConcreteDecorator）角色：实现抽象装饰的相关方法，并给具体构件对象添加附加的责任。</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>SpringSession中如何进行session与redis关联？HttpRequestWrapper</li>
<li>MybatisPlus提取了Querywrapper，这是为什么</li>
<li>Spring中的BeanWrapper是做什么的？包装了Bean，bean的功能增强？</li>
<li>SpringWebflux中的WebHandlerDecorator</li>
<li>已存在的类，某一天在某个功能使用的时候发现不够，就可以使用装饰类。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 抽象构建</span><br><span class="hljs-keyword">public</span>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ManTikTok</span> &#123;<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// 具体构件角色</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZhangTikTok</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ManTikTok</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;张三，tiktok.... &quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 抽象装饰角色</span><br><span class="hljs-comment">// 给抖音直播增加新的功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TiktokDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ManTikTok</span>&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">enable</span><span class="hljs-params">()</span>;<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 美颜装饰器</span><br><span class="hljs-comment"> *      装饰谁？</span><br><span class="hljs-comment"> *  装饰器只关系增强这个类的方法。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MeiYanDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TiktokDecorator</span>&#123;<br><br>    <span class="hljs-keyword">private</span> ManTikTok manTikTok;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MeiYanDecorator</span><span class="hljs-params">(ManTikTok manTikTok)</span>&#123;<br>        <span class="hljs-built_in">this</span>.manTikTok = manTikTok;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//开启美颜，新增的功能</span><br>        enable();<br>        <span class="hljs-comment">//我开始直播</span><br>        manTikTok.tiktok();<br>    &#125;<br><br><br>	<span class="hljs-comment">// 定义的增强功能</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enable</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;看这个美女.....&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;花花花花花花花花花花花&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 核心：想要不改变原来接口方法的情况下扩展新功能，或者增强方法.....</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//被装饰对象</span><br>        <span class="hljs-type">ManTikTok</span> <span class="hljs-variable">manTikTok</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeiTikTok</span>();<br>        <span class="hljs-comment">// 适配器</span><br>        <span class="hljs-type">MeiYanDecorator</span> <span class="hljs-variable">decorator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeiYanDecorator</span>(manTikTok);<br>        decorator.tiktok();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-代理（Proxy）模式"><a href="#2-4-代理（Proxy）模式" class="headerlink" title="2.4 代理（Proxy）模式"></a>2.4 代理（Proxy）模式</h3><p>代理模式，给某一个对象提供一个代理，并由代理对象控制对原对象的引用。对象结构型模式。</p>
<ul>
<li>Subject：抽象主体角色（抽象类或接口）</li>
<li>Proxy：代理主体角色（代理对象类）</li>
<li>RealSubject：真实主体角色（被代理对象类）</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>Mybatis中的mapper到底是什么？怎么生成的？<ul>
<li>动态代理</li>
<li>UserMapper、CityMapper，mybatis帮我们写实现MapperProxy</li>
</ul>
</li>
<li>Seata的DataSourceProxy是什么</li>
<li>DruidDataSource存在的Proxy模式：监控链…</li>
</ul>
<p><strong>区别–装饰器、代理</strong></p>
<ul>
<li>装饰器和代理之间的区别很细微，可以认为装饰器是代理的一个子集</li>
<li>静态代理就是装饰器的方式</li>
</ul>
<h4 id="2-4-1-静态代理（static）"><a href="#2-4-1-静态代理（static）" class="headerlink" title="2.4.1 静态代理（static）"></a>2.4.1 静态代理（static）</h4><p>静态代理和装饰器模式差不多</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* 抽象主体。被代理角色能干什么 */</span><br><span class="hljs-keyword">public</span>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ManTikTok</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">/** Subject  主体 */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeiTikTok</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ManTikTok</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;雷丰阳，tiktok.... &quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 代理一般都是和被代理对象属于同一个接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LiMingTiktokProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ManTikTok</span>&#123;<br><br>    <span class="hljs-keyword">private</span> ManTikTok manTikTok; <span class="hljs-comment">//被代理对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LiMingTiktokProxy</span><span class="hljs-params">(ManTikTok manTikTok)</span>&#123;<br>        <span class="hljs-built_in">this</span>.manTikTok = manTikTok;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//增强功能</span><br>        System.out.println(<span class="hljs-string">&quot;渲染直播间....&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;课程只要666，仅此一天....&quot;</span>);<br>        manTikTok.tiktok();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-4-2-动态代理（dynamic）"><a href="#2-4-2-动态代理（dynamic）" class="headerlink" title="2.4.2 动态代理（dynamic）"></a>2.4.2 动态代理（dynamic）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 还是选择抖音卖货</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ManTikTok</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeiTikTok</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ManTikTok</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktok</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;直播卖课啦，快来买&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// 如果这里面有自己定义的方法，而不是实现接口的方法</span><br>    <span class="hljs-comment">// JDK动态代理将不能代理该本类自己的方法</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>代理类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKTiktokProxy</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocaationHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> T target;<br>    <span class="hljs-comment">// 接受被代理的对象</span><br>    JDKTiktokProxy(T target) &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 获取被代理的对象的代理对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; T <span class="hljs-title function_">getProxy</span><span class="hljs-params">(T t)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        	ClassLoader loader：当前被代理对象的类加载器</span><br><span class="hljs-comment">        	Class&lt;?&gt;[] interfaces：当前被代理对象所实现的所有接口</span><br><span class="hljs-comment">        	InvocationHandler h</span><br><span class="hljs-comment">        		当前被代理对象执行目标方法的时候我们可以使用h可以定义拦截增强方法</span><br><span class="hljs-comment">        */</span><br>        <span class="hljs-keyword">return</span> (T)Proxy.newProxyInstance(<br>        	t.getClass().getClassLoader(),<br>            t.getClass().getInterfaces(), <span class="hljs-comment">//必须为接口</span><br>        	<span class="hljs-keyword">new</span> <span class="hljs-title class_">JDKTiktokProxy</span>(t));<br>    &#125;<br>    <br>    <span class="hljs-comment">// 定义目标方法的拦截逻辑；每个方法都会进来的</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy,</span><br><span class="hljs-params">                        Method method,</span><br><span class="hljs-params">                        Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">// 反射执行，可以给方法添加新的功能</span><br>        System.out.println(<span class="hljs-string">&quot;真正执行被代理对象的方法&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">invoke</span> <span class="hljs-operator">=</span> method.invoke(target, args);<br>        System.out.println(<span class="hljs-string">&quot;我是增强逻辑&quot;</span>);<br>        <span class="hljs-keyword">return</span> invoke;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ManTikTok</span> <span class="hljs-variable">leiTikTok</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeiTikTok</span>();<br>    <span class="hljs-type">ManTikTk</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> JDKTiktokProxy.getProxy(leiTikTok);<br>    proxy.tiktok();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果使用代理对象执行本类的接口，将会出现以下错误：</p>
<div style="color :red">Exception in thread "main" java.lang.ClassCastException: com.sun.proxy.$Proxy0 cannot be cast to com.atguigu.design.structural.proxy.dynamic.LeiTikTok
    at com.atguigu.design.structural.proxy.dynamic.MainTest.main(MainTest.java:29)</div>


<h4 id="2-4-3-Cglib代理"><a href="#2-4-3-Cglib代理" class="headerlink" title="2.4.3 Cglib代理"></a>2.4.3 Cglib代理</h4><p>首先需要添加相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/cglib/cglib --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>它和JDK动态代理的好处就是可以代理本类自己的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Subject  主体</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeiTikTok</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tiktokHaha</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;雷丰阳，tiktok.... haha....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>使用cglib帮我们创建出代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxy</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T t)</span> &#123;<br>        <span class="hljs-comment">// 1、创建一个增强器</span><br>        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();<br>        <span class="hljs-comment">// 2、设置要增强哪个类的功能，增强器为这个类动态创建一个子类</span><br>        enhancer.setSuperClass(t.getClass());<br>        <span class="hljs-comment">// 3、设置回调</span><br>        <span class="hljs-comment">// 为了能获取到原方法的一些元数据信息</span><br>        enhancer.setCallback((MethodInterceptor) (obj, method, args, proxy) -&gt; &#123;<br>            <span class="hljs-comment">// 编写拦截的逻辑</span><br>            System.out.println(<span class="hljs-string">&quot;cglib上场了&quot;</span>);<br>            <span class="hljs-comment">// 也可以通过method参数获取到当前方法的相应信息</span><br>            <span class="hljs-keyword">return</span> proxy.invokSuper(obj, args);<br>        &#125;);<br>        <span class="hljs-keyword">return</span> (T)enhancer.create();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">man</span><span class="hljs-params">(String[] args)</span> &#123;<br>   	<span class="hljs-type">LeiTikTok</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> CglibProxy.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LeiTikTok</span>());<br>    proxy.tiktokHaha();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-5-组合（Composite）模式"><a href="#2-5-组合（Composite）模式" class="headerlink" title="2.5 组合（Composite）模式"></a>2.5 组合（Composite）模式</h3><p>组合模式就是把一组相似的对象当作一个单一的对象。如树形菜单</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221115100969.png" srcset="/img/loading.gif" lazyload alt="image-20211221115100969"></p>
<h3 id="2-6-外观（Facade）模式"><a href="#2-6-外观（Facade）模式" class="headerlink" title="2.6 外观（Facade）模式"></a>2.6 外观（Facade）模式</h3><p>又叫做门面模式，是一种通过<strong>为多个复杂的子系统提供一个一致的接口</strong>，而使这些子系统更加容易被访问的模式。</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221115249590.png" srcset="/img/loading.gif" lazyload alt="image-20211221115249590"></p>
<p><strong>使用场景</strong></p>
<ul>
<li>去医院看病，可能要去挂号、门诊、取药等等，让患者和家属觉得很复杂，如果有提供接待人员，只让接待人员来处理，就很方便</li>
<li>JAVA的三层开发模式</li>
<li>分布式系统的网关</li>
<li>Tomcat源码中的RequestFacade</li>
</ul>
<h3 id="2-7-享元（Flyweight）模式"><a href="#2-7-享元（Flyweight）模式" class="headerlink" title="2.7 享元（Flyweight）模式"></a>2.7 享元（Flyweight）模式</h3><ul>
<li><strong>运用共享技术有效地支持大量细粒度对象的复用</strong>。系统只使用少量的对象，而这些对象都很相似，状态变化很小，可以实现对象的多次复用。对象结构型</li>
<li>在享元模式中<strong>可以共享的相同内容称为内部状态（IntrinsicState）</strong>，而那些需要外部环境来设置的<strong>不能共享的内容称为外部状态（ExtrinsicState）</strong>，由于区分了内部状态和外部状态，因此可以通过设置不同的外部状态使得相同的对象可以具有一些不同的特征，而相同的内部状态是可以共享的</li>
<li>在享元模式中通常会出现工厂模式，而创建一个<strong>享元工厂来负责维护一个享元池</strong>（Flyweight Pool）用于存储具有相同内部状态的对象</li>
<li>享元模式包含以下角色：<ul>
<li>Flyweight：抽象享元类Connection</li>
<li>ConcreteFlyweight：具体享元类 ConnectionImpl（user, pwd, url）</li>
<li>UnsharedConcreteFlyweight：非共享具体享元类ConnectionImpl（state）</li>
<li>FlyweightFactory：享元工厂类；简单工厂，产品就一个Connection</li>
</ul>
</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221121625676.png" srcset="/img/loading.gif" lazyload alt="image-20211221121625676"></p>
<p><strong>使用场景</strong></p>
<ul>
<li>数据库连接池</li>
<li>所有的池化技术</li>
<li>享元和原型模式有什么区别？享元是预先准备好的对象进行复用，原型没法确定预先有哪些。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 可共享和不可共享状态</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractWaitressFlyweight</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">canService</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 能否服务</span><br>    <span class="hljs-comment">// 正在服务。享元的不可共享属性留给外部进行改变的接口</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// 服务完成。</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">end</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCanService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> canService;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 具体享元类</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeautifulWaitress</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractWaitressFlyweight</span> &#123;<br>    String id;<br>    String name;<br>    <span class="hljs-type">int</span> age;<br>    <span class="hljs-comment">// 以上是不变的</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;工号：&quot;</span>+id+<span class="hljs-string">&quot;；&quot;</span>+name+<span class="hljs-string">&quot; &quot;</span>+age+<span class="hljs-string">&quot; 正在为您服务...&quot;</span>);<br>        <span class="hljs-comment">//改变外部状态</span><br>        <span class="hljs-built_in">this</span>.canService = <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">end</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;工号：&quot;</span>+id+<span class="hljs-string">&quot;；&quot;</span>+name+<span class="hljs-string">&quot; &quot;</span>+age+<span class="hljs-string">&quot; 服务结束...请给五星好评&quot;</span>);<br>        <span class="hljs-built_in">this</span>.canService = <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 足道店：这相当于享元工厂</span><br><span class="hljs-comment"> *      店里面很多服务员。</span><br><span class="hljs-comment"> * 享元和原型</span><br><span class="hljs-comment"> * 1、享元返回的是这个本人。</span><br><span class="hljs-comment"> * 2、原型返回的是克隆人。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZuDao</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String,AbstractWaitressFlyweight&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">//享元，池子中有对象</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-type">BeautifulWaitress</span> <span class="hljs-variable">waitress</span> <span class="hljs-operator">=</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeautifulWaitress</span>(<span class="hljs-string">&quot;1111&quot;</span>,<span class="hljs-string">&quot;张三&quot;</span>,<span class="hljs-number">18</span>);<br>        <span class="hljs-type">BeautifulWaitress</span> <span class="hljs-variable">waitress2</span> <span class="hljs-operator">=</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeautifulWaitress</span>(<span class="hljs-string">&quot;9527&quot;</span>,<span class="hljs-string">&quot;李四&quot;</span>,<span class="hljs-number">20</span>);<br>        pool.put(waitress.id,waitress);<br>        pool.put(waitress2.id,waitress2);<br>    &#125;<br>    <span class="hljs-comment">// 向池子中添加对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addWaitress</span><span class="hljs-params">(AbstractWaitressFlyweight waitressFlyweight)</span>&#123;<br>        pool.put(UUID.randomUUID().toString(),waitressFlyweight);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AbstractWaitressFlyweight <span class="hljs-title function_">getWaitress</span><span class="hljs-params">(String name)</span>&#123;<br>        <span class="hljs-type">AbstractWaitressFlyweight</span> <span class="hljs-variable">flyweight</span> <span class="hljs-operator">=</span> pool.get(name);<br>        <span class="hljs-keyword">if</span>(flyweight == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">for</span> (AbstractWaitressFlyweight value : pool.values()) &#123;<br>                <span class="hljs-comment">//当前共享对象能否是否</span><br>                <span class="hljs-keyword">if</span>(value.isCanService())&#123;<br>                    <span class="hljs-keyword">return</span> value;<br>                &#125;<br>            &#125;;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> flyweight;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>    <span class="hljs-comment">//1、我</span><br>    <span class="hljs-type">AbstractWaitressFlyweight</span> <span class="hljs-variable">waitress</span> <span class="hljs-operator">=</span> ZuDao.getWaitress(<span class="hljs-string">&quot;&quot;</span>);<br>    waitress.service();<br>    System.out.println(waitress);<br>    <span class="hljs-comment">//2、佟老师</span><br>    <span class="hljs-type">AbstractWaitressFlyweight</span> <span class="hljs-variable">waitress1</span> <span class="hljs-operator">=</span> ZuDao.getWaitress(<span class="hljs-string">&quot;&quot;</span>);<br>    waitress1.service();<br>    System.out.println(waitress1);<br><br>    waitress1.end();<br>    <span class="hljs-comment">//3、刘佳林</span><br>    <span class="hljs-type">AbstractWaitressFlyweight</span> <span class="hljs-variable">waitress2</span> <span class="hljs-operator">=</span> ZuDao.getWaitress(<span class="hljs-string">&quot;&quot;</span>);<br>    System.out.println(waitress2);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-8-过滤器（Filter）模式"><a href="#2-8-过滤器（Filter）模式" class="headerlink" title="2.8 过滤器（Filter）模式"></a>2.8 过滤器（Filter）模式</h3><p>使用不同的标准来过滤一组对象，通过逻辑运算以解耦的方式把它们连接起来。结合多个标准来获得单一标准。</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/design-pattern/filter-pattern.html">https://www.runoob.com/design-pattern/filter-pattern.html</a></p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221122333684.png" srcset="/img/loading.gif" lazyload alt="image-20211221122333684"></p>
<h2 id="第三章-行为型模式"><a href="#第三章-行为型模式" class="headerlink" title="第三章 行为型模式"></a>第三章 行为型模式</h2><ul>
<li>行为型模式关注点<strong>怎样运行对象&#x2F;类</strong>，所以我们关注下类&#x2F;对象的运行时流程控制</li>
<li>行为型模式用于描述程序在运行时复杂的流程控制</li>
<li>描述多个类或对象之间怎样相互协作共同完成单个对象都无法单独完成的任务，它涉及算法与对象间职责的分配。</li>
<li>行为型模式分为类行为模式和对象行为模式，前者采用继承•机制来在类间分派行为，后者采用组合或聚合在对象间分配行为。由于组合关系或聚合关系比继承关系耦合度低，满足“<strong>合成复用原则</strong>”，所以对象行为模式比类行为模式具有更大的灵活性。</li>
</ul>
<p><strong>行为型模式分类</strong></p>
<ul>
<li>模板方法（Template Method）模式：父类定义算法骨架，某些实现放在子类</li>
<li>策略（Strategy）模式：每种算法独立封装，根据不同情况使用不同算法策略</li>
<li>状态（State）模式：每种状态独立封装，不同状态内部封装了不同行为</li>
<li>命令（Command）模式：将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分割开</li>
<li>职责链（Chain of Responsibility）模式：所有处理者封装为链式结构，依次调用</li>
<li>备忘录（Memento）模式：把核心信息抽取出来，可以进行保存</li>
<li>解释器（Interpreter）模式：定义语法解析规则</li>
<li>观察者（Observer）模式：维护多个观察者依赖，状态变化通知所有观察者</li>
<li>中介者（Mediator）模式：取消类&#x2F;对象的直接调用关系，使用中介者维护</li>
<li>迭代器（Iterator）模式：定义集合数据的遍历规则</li>
<li>访问者（Visitor）模式：分离对象结构，与元素的执行算法</li>
</ul>
<p>除了模板方法模式和解释器模式是类行为模式，其他的都属于对象行为模式</p>
<h3 id="3-1-模板方法（Template-Method）模式"><a href="#3-1-模板方法（Template-Method）模式" class="headerlink" title="3.1 模板方法（Template Method）模式"></a>3.1 模板方法（Template Method）模式</h3><p>在该模式中，一个抽象类公开定义了执行它的方法的方式模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方法进行。</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221124450298.png" srcset="/img/loading.gif" lazyload alt="image-20211221124450298"></p>
<p><strong>使用场景</strong></p>
<ul>
<li>Spring的整个继承体系都基本用到模板方法：BeanFactory.getBean</li>
<li>JdbcTemplate、RedisTemplate都允许我们再扩展</li>
<li>我们自己的系统也应该使用模板方法组织类结构</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、定义模板</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CookTemplate</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义算法：  定义好了模板</span><br><span class="hljs-comment">     * 父类可以实现某些步骤</span><br><span class="hljs-comment">     * 留关键给子类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cook</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//定义算法步骤</span><br>        heating();   <span class="hljs-comment">//v</span><br>        addfood();<br>        addsalt();<br>        stirfry();   <span class="hljs-comment">//v</span><br>        end();      <span class="hljs-comment">//v</span><br>    &#125;<br><br>    <span class="hljs-comment">//加热方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heating</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;开火...&quot;</span>);<br>    &#125;;<br>    <span class="hljs-comment">//添加食物</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addfood</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">//加盐</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addsalt</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">//翻炒</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">stirfry</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;翻炒中...&quot;</span>);<br>    &#125;;<br>    <span class="hljs-comment">//出锅</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">end</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;出锅....&quot;</span>);<br>    &#125;;<br>&#125;<br><br><span class="hljs-comment">// 实现父类留给子类自定义的方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoCookMachine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CookTemplate</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addfood</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;放了三个小白菜&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addsalt</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;放了三勺盐&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AutoCookMachine</span> <span class="hljs-variable">cookMachine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoCookMachine</span>();<br>        cookMachine.cook();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-策略（Strategy）模式"><a href="#3-2-策略（Strategy）模式" class="headerlink" title="3.2 策略（Strategy）模式"></a>3.2 策略（Strategy）模式</h3><p>策略模式定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的变化不会影响使用算法的客户。属于对象行为模式</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221124858117.png" srcset="/img/loading.gif" lazyload alt="image-20211221124858117"></p>
<p><strong>主要角色</strong></p>
<ul>
<li>抽象策略类：公共接口，各种不同的算法以不同的方式实现这个接口，环境角色使用这个接口调用不同的算法，一般使用接口或抽象类实现。</li>
<li>具体策略类：实现了抽象策略定义的接口，提供具体的算法实现。</li>
<li>环境类：持有一个策略类的引用，最终给客户端调用。</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>使用策略模式可以避免使用多重条件语句，如if else语句、switch</li>
<li>什么是Spring中的InstantiationStrategy</li>
<li>线程池拒绝策略</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* 游戏策略 */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GameStrategy</span> &#123;<br>    <span class="hljs-comment">//战斗策略</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">warStrategy</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RandomStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GameStrategy</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warStrategy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;大乱斗...&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 稳健运营策略</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SteadyStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GameStrategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warStrategy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;各路小心...及时支援...&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 环境类，也可以通过构造函数强行让其指定策略</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeamGNR</span> &#123;<br><br>    <span class="hljs-comment">//抽取游戏策略算法，并进行引用</span><br>    <span class="hljs-keyword">private</span> GameStrategy gameStrategy;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGameStrategy</span><span class="hljs-params">(GameStrategy gameStrategy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.gameStrategy = gameStrategy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startGame</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;游戏开始.....&quot;</span>);<br>        <span class="hljs-comment">//游戏策略</span><br>        gameStrategy.warStrategy();<br>        System.out.println(<span class="hljs-string">&quot;win......&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">TeamGNR</span> <span class="hljs-variable">gnr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeamGNR</span>();<br>        gnr.setGameStrategy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomStrategy</span>());<br>        gnr.startGame();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-状态（State）模式"><a href="#3-3-状态（State）模式" class="headerlink" title="3.3 状态（State）模式"></a>3.3 状态（State）模式</h3><p>对有状态的对象，把复杂的”判断逻辑“提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221125524010.png" srcset="/img/loading.gif" lazyload alt="image-20211221125524010"></p>
<p><strong>重点是状态的流转</strong></p>
<p><strong>应用场景</strong></p>
<ul>
<li>状态模式核心<strong>需要具体状态类能在必要的时候切换状态</strong>，和策略模式不一样</li>
<li>流程框架和状态机</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** * 抽象状态*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TeamState</span> &#123;<br>    <span class="hljs-comment">//玩游戏</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">//切换到下一个状态</span><br>    TeamState <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 竞赛状态</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MatchState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TeamState</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;全力以赴打比赛....&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//状态模式的核心</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> TeamState <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VocationState</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 休假状态</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VocationState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TeamState</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;三亚旅游真舒服....饿了...不玩游戏&quot;</span>);<br>        <span class="hljs-comment">//状态流转</span><br><br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> TeamState <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeafNodleState</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 吃牛肉面状态</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeafNodleState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TeamState</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;饱饱的一顿牛肉面......中了诅咒，输了&quot;</span>);<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> TeamState <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MatchState</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>环境类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SKTTeam</span> &#123;<br>    <span class="hljs-keyword">private</span> TeamState teamState;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTeamState</span><span class="hljs-params">(TeamState teamState)</span> &#123;<br>        <span class="hljs-built_in">this</span>.teamState = teamState;<br>    &#125;<br><br>    <span class="hljs-comment">//开始游戏</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startGame</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//状态不同会导致不同的游戏结果</span><br>        teamState.playGame();<br>    &#125;<br><br>    <span class="hljs-comment">//下一个状态 可以通过环境类调，也可以直接使用抽象状态的next方法</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">nextState</span><span class="hljs-params">()</span>&#123;<br>        teamState = teamState.next();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 状态切换</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">SKTTeam</span> <span class="hljs-variable">sktTeam</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SKTTeam</span>();<br>        <span class="hljs-type">TeamState</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VocationState</span>();<br>        sktTeam.setTeamState(state);<br>        sktTeam.startGame();<br><br>        <span class="hljs-comment">//        sktTeam.startGame();</span><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-comment">//        sktTeam.nextState();</span><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-comment">//        sktTeam.startGame();</span><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-comment">//        sktTeam.nextState();</span><br>        <span class="hljs-comment">//        sktTeam.startGame();</span><br><br>        state = state.next();<br>        sktTeam.setTeamState(state);<br>        sktTeam.startGame();<br><br>        <span class="hljs-comment">//状态需要维护自己的切换逻辑</span><br>        state = state.next();<br>        sktTeam.setTeamState(state);<br>        sktTeam.startGame();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-4-中介者（Mediator）模式"><a href="#3-4-中介者（Mediator）模式" class="headerlink" title="3.4 中介者（Mediator）模式"></a>3.4 中介者（Mediator）模式</h3><p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221130132252.png" srcset="/img/loading.gif" lazyload alt="image-20211221130132252"></p>
<p>中介者模式：用一个中介对象来封装一系列的对象交互，中介者使各对象不需要显示地相互引用，减少对象间混乱的依赖关系，从而使其耦合松散，而且可以独立地改变它们之间的交互。对象行为模式</p>
<p>如上图所示，用一个塔台来管理所有的飞机，在飞机想要降落的时候，就看塔台允不允许降落；飞机想要起飞的时候，就看塔台允不允许起飞。</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221131311183.png" srcset="/img/loading.gif" lazyload alt="image-20211221131311183"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>SpringMVC中的DispatcherServlet是一个中介者，他会提取Controller、Model、View来进行调用。而无需Controller直接调用view之类的渲染方法</li>
<li>分布式系统中的网关</li>
<li>迪米特发法则的一个典型应用</li>
<li>中介者和外观（门面）模式区别：中介者双向操作，门面偏向于封装某一方</li>
</ul>
<h3 id="3-5-观察者（Observer）模式"><a href="#3-5-观察者（Observer）模式" class="headerlink" title="3.5 观察者（Observer）模式"></a>3.5 观察者（Observer）模式</h3><p>定义对象间的一种<strong>一对多依赖关系</strong>，使得每<strong>当一个对象状态发生改变</strong>时，其相关<strong>依赖对象皆得到通知</strong>并被<strong>自动更新</strong>。观察者模式又叫做<strong>发布-订阅</strong>（Publisher&#x2F;Subscribe）模式、模型-视图模式、源-监听器模式或从属模式。对象行为模式</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221131950615.png" srcset="/img/loading.gif" lazyload alt="image-20211221131950615"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>Spring事件机制如何实现</li>
<li>Vue的双向绑定核心</li>
<li>响应式编程核心思想</li>
</ul>
<h3 id="3-6-备忘录（Memento）模式"><a href="#3-6-备忘录（Memento）模式" class="headerlink" title="3.6 备忘录（Memento）模式"></a>3.6 备忘录（Memento）模式</h3><p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后当需要时能将该对象恢复到原先保存的状态。该模式又叫<strong>快照模式</strong>。对象行为型模式</p>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221135327385.png" srcset="/img/loading.gif" lazyload alt="image-20211221135327385"></p>
<ul>
<li>发起人（Originator）角色：记录当前时刻的内部状态信息，提供创建备忘录和恢复备忘录数据的功能，实现其他业务功能，它可以访问备忘录里的所有信息</li>
<li>备忘录（Memento）角色：负责存储发起人的内部状态，在需要的时候提供这些内部状态给发起人</li>
<li>管理者（Caretaker）角色：对备忘录进行管理，提供保存与获取备忘录的功能，但其不能对备忘录的内容进行访问与修改。</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>游戏存档</li>
<li>数据库保存点事务（savepoint）</li>
<li>session活化钝化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 游戏记录。需要保存的内部状态信息，</span><br><span class="hljs-comment"> *      也叫备忘录信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameRecord</span> &#123;<br>    Integer id; <span class="hljs-comment">//代表生成记录的id</span><br>    Integer coin;<span class="hljs-comment">//剩余金币</span><br>    Integer hp;<span class="hljs-comment">//血量</span><br>    Integer mp;<span class="hljs-comment">//蓝量</span><br>    Integer level;<span class="hljs-comment">//等级</span><br><br>    <span class="hljs-comment">//获取当前备忘录信息</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getCurrent</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;coin：&quot;</span>+coin+<span class="hljs-string">&quot;；\t&quot;</span>+<span class="hljs-string">&quot;hp：&quot;</span>+hp+<span class="hljs-string">&quot;；\t mp：&quot;</span>+mp);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>当前游戏信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 游戏者： 游戏发起人</span><br><span class="hljs-comment"> * 当前游戏信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeiGamer</span>  &#123;<br>    Integer coin;<span class="hljs-comment">//剩余金币</span><br>    Integer hp;<span class="hljs-comment">//血量</span><br>    Integer mp;<span class="hljs-comment">//蓝量</span><br>    Integer level;<span class="hljs-comment">//等级</span><br>    <span class="hljs-comment">//以上的是内部状态，我们需要记录保存的信息</span><br><br>    <span class="hljs-type">GameServer</span> <span class="hljs-variable">gameServer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GameServer</span>();<br><br>    <span class="hljs-comment">//保存游戏记录</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveGameRecord</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;正在保存当前记录....&quot;</span>);<br>        <span class="hljs-type">GameRecord</span> <span class="hljs-variable">gameRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GameRecord</span>();<br>        <span class="hljs-comment">//当前游戏信息保存到备忘录</span><br>        BeanUtils.copyProperties(gameRecord,<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">//</span><br>        gameServer.add(gameRecord);<br>    &#125;<br><br>    <span class="hljs-comment">//从备忘录获取游戏历史存档</span><br>    LeiGamer <span class="hljs-title function_">getFromMemento</span><span class="hljs-params">(Integer id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;获取历史存档信息....&quot;</span>);<br>        <span class="hljs-type">LeiGamer</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> gameServer.getRecord(id);<br>        <span class="hljs-keyword">return</span> record;<br>    &#125;<br><br>    <span class="hljs-comment">//玩游戏</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt();<br>        System.out.println(<span class="hljs-string">&quot;......(〃&#x27;▽&#x27;〃)......&quot;</span>+i);<br>        coin = i;<br>        hp = i;<br>        mp = i;<br>        level = i;<br>    &#125;<br><br>    <span class="hljs-comment">//退出游戏</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitGame</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;退出&amp;存档&quot;</span>);<br>        saveGameRecord();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>游戏服务器，存储游戏信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 游戏服务器</span><br><span class="hljs-comment"> * 管理者</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameServer</span> &#123;<br><br>    <span class="hljs-comment">//管理备忘录信息的</span><br>    Map&lt;Integer,GameRecord&gt; records = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(GameRecord gameRecord)</span>&#123;<br>        gameRecord.setId(i++);<br>        records.put(gameRecord.id,gameRecord);<br>    &#125;<br><br>    LeiGamer <span class="hljs-title function_">getRecord</span><span class="hljs-params">(Integer id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">GameRecord</span> <span class="hljs-variable">gameRecord</span> <span class="hljs-operator">=</span> records.get(id);<br>        <span class="hljs-comment">//获取到备忘录里面的内容以后还要逆转</span><br>        <span class="hljs-type">LeiGamer</span> <span class="hljs-variable">leiGamer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeiGamer</span>();<br><span class="hljs-comment">//        leiGamer.setCoin(gameRecord.getCoin());</span><br>        <span class="hljs-comment">//BeanUtils：工具类，属性对拷</span><br>        BeanUtils.copyProperties(leiGamer,gameRecord);<br>        <span class="hljs-keyword">return</span>  leiGamer;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-7-解释器（Interpreter）模式"><a href="#3-7-解释器（Interpreter）模式" class="headerlink" title="3.7 解释器（Interpreter）模式"></a>3.7 解释器（Interpreter）模式</h3><p>给<strong>分析对象定义一个语言，并定义该语言的文法表示</strong>，再<strong>设计一个解释器</strong>来<strong>解释语言中的句子</strong>。也就是说，用编译语言的方式来分析应用中的实例。这种模式实现了文法表达式处理的接口，该接口解释一个特定的上下文。类行为模式</p>
<p><strong>主要角色</strong>：</p>
<ul>
<li>抽象表达式（Abstract Expression）角色：定义解释器的接口，约定解释器的解释操作，主要包含解释方法interpret（）</li>
<li>终结符表达式（Terminal Expression）角色：是抽象表达式的子类，用来实现文法中与终结符相关的操作，文法中的每一个终结符都有一个具体终结表达式与之相对应</li>
<li>非终结符表达式（Nonterminal Expression）角色：也是抽象表达式的子类，用来实现文法中与非终结符相关的操作，文法中的每条规则都对应于一个非终结符表达式</li>
<li>环境（Context）角色：通常包含各个解释器需要的数据或是公共的功能，一般用来传递被所有解释器共享的数据，后面的解释器可以从这里获取这些值</li>
<li>客户端（Client）：主要任务是将需要分析的句子或表达式转换成使用解释器对象描述的抽象语法树，然后调用解释器的解释方法，当然也可以i通过环境角色间接访问解释器的解释方法</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221140524951.png" srcset="/img/loading.gif" lazyload alt="image-20211221140524951"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>Spring的表达式解析：#{}</li>
<li>Thymeleaf等模板引擎的语法解析</li>
<li>编译原理</li>
<li>编译器</li>
<li>execution( * top.noaharno.. (int,..))</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 身份信息表达式</span><br><span class="hljs-comment"> * 表达式的解析</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IDCardExpression</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义解析逻辑</span><br><span class="hljs-comment">     * 假设我们需要解析的信息格式为：</span><br><span class="hljs-comment">     *      上海市：张文宏-医生</span><br><span class="hljs-comment">     *      武汉市：雷丰阳-程序员</span><br><span class="hljs-comment">     *      北京市：宋宋-老人</span><br><span class="hljs-comment">     *  表达式中，“：”以前的是城市，“-”以后的是职业</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> expression</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String expression)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 终结符表达式</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 多少种解析规则就需要定义多少种规则类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TerminalExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IDCardExpression</span> &#123;<br><br>    IDCardExpression childExp;<br><br>    Set&lt;String&gt; data;  <span class="hljs-comment">//免费数据</span><br>    String symbol; <span class="hljs-comment">//定义解析用的符号如  ： -</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TerminalExpression</span><span class="hljs-params">( Set&lt;String&gt;  data,String symbol)</span>&#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>        <span class="hljs-built_in">this</span>.symbol = symbol;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String expression)</span> &#123;<br>        <span class="hljs-comment">//上海市：张文宏-医生</span><br>        <span class="hljs-comment">//1、先按照指定符号分割</span><br>        String[] split = expression.split(symbol);<br><br>        <span class="hljs-comment">// 冒号：  上海市              张文宏-医生</span><br>        <span class="hljs-comment">// 短横线  上海市：张文宏       医生</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span> (String s : split) &#123;<br>            <span class="hljs-keyword">if</span>(data.contains(s))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;;<span class="hljs-comment">//说明是免费的信息里面的</span><br>        &#125;<br><br>        <span class="hljs-comment">//可以继续子解析</span><br><span class="hljs-comment">//        childExp.interpret(expression);</span><br><br>        <span class="hljs-comment">//不在免费行列</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 非终结表达式</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IDCardExpression</span> &#123;<br><br>    <span class="hljs-comment">//组合两个终结表达式。最终的判断结果是终结表达式判断出来的，这个表达式只是一个桥梁</span><br>    <span class="hljs-keyword">private</span> IDCardExpression cityExp;<br>    <span class="hljs-keyword">private</span> IDCardExpression typeExp;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrExpression</span><span class="hljs-params">(IDCardExpression cityExp, IDCardExpression typeExp)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cityExp = cityExp;<br>        <span class="hljs-built_in">this</span>.typeExp = typeExp;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String expression)</span> &#123;<br><br>        <span class="hljs-comment">//定义所有终结表达式的合并逻辑</span><br>        <span class="hljs-keyword">return</span> cityExp.interpret(expression) || typeExp.interpret(expression);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 环境类：</span><br><span class="hljs-comment"> * 风景区</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Area</span> &#123;<br>    Set&lt;String&gt; city = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><br><br>    Set&lt;String&gt; type = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    IDCardExpression idCardReader;<span class="hljs-comment">//读卡器，表达式解析器</span><br><br>    <span class="hljs-comment">//环境类持有表达式</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Area</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        &#123;&quot;武汉市&quot;,&quot;上海市&quot;&#125;;//免费城市</span><br><span class="hljs-comment">//        &#123;&quot;医生&quot;,&quot;老人&quot;,&quot;儿童&quot;&#125;;//免费人群</span><br>        city.add(<span class="hljs-string">&quot;武汉市&quot;</span>);<br>        city.add(<span class="hljs-string">&quot;上海市&quot;</span>);<br><br>        type.add(<span class="hljs-string">&quot;医生&quot;</span>);<br><span class="hljs-comment">//        type.add(&quot;老人&quot;);</span><br>        type.add(<span class="hljs-string">&quot;儿童&quot;</span>);<br>        <span class="hljs-comment">//最小解析</span><br>        <span class="hljs-type">TerminalExpression</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerminalExpression</span>(<span class="hljs-built_in">this</span>.city, <span class="hljs-string">&quot;:&quot;</span>);<br>        <span class="hljs-comment">//最小解析</span><br>        <span class="hljs-type">TerminalExpression</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerminalExpression</span>(<span class="hljs-built_in">this</span>.type, <span class="hljs-string">&quot;-&quot;</span>);<br><br><br>        <span class="hljs-comment">//以上满足一个即可</span><br>        idCardReader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrExpression</span>(city,type);<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 传入表达式，判断当前表达式是否指定为免费人群</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> expression</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getTicket</span><span class="hljs-params">(String expression)</span>&#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">interpret</span> <span class="hljs-operator">=</span> idCardReader.interpret(expression);<br>        <span class="hljs-keyword">if</span>(interpret)&#123;<br>            System.out.println(<span class="hljs-string">&quot;恭喜你，免票通过....&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;对不起，请2元购票....&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">Area</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Area</span>();<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         *  上海市：张文宏-医生</span><br><span class="hljs-comment">         *  武汉市:雷丰阳-程序员</span><br><span class="hljs-comment">         *  北京市：宋宋-老人</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;武汉市:雷丰阳-程序员&quot;</span>;<br><br>        area.getTicket(sr);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-8-命令（Command）模式"><a href="#3-8-命令（Command）模式" class="headerlink" title="3.8 命令（Command）模式"></a>3.8 命令（Command）模式</h3><p>将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分隔开。这样两者之间通过命令对象进行沟通，这样方便将命令对象进行存储、传递、调用、增加与管理</p>
<p><strong>其实我们使用的controller、service、dao就是典型的命令模式</strong></p>
<p><strong>主要角色</strong></p>
<ul>
<li>抽象命令类角色：声明执行命令的接口，拥有执行命令的抽象方法execute</li>
<li>具体命令类角色：是抽象命令类的具体实现类，它拥有接收者对象，并通过调用接收者的功能来完成命令要执行的操作。</li>
<li>实现者&#x2F;接收者角色：执行命令功能的相关操作，是具体命令对象业务的真正实现者</li>
<li>调用者&#x2F;请求者角色：是请求的发送者，它通常拥有很多的命令对象，并通过访问命令对象来执行相关请求，它不直接访问接收者。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221141517304.png" srcset="/img/loading.gif" lazyload alt="image-20211221141517304"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>mvc就是典型的命令模式</li>
<li>当系统需要执行一组操作时，命令模式可以定义宏命令（一个命令组合了多个命令）来实现该功能</li>
<li>结合备忘录模式还可以实现命令的撤销和恢复</li>
</ul>
<h3 id="3-9-迭代器（Iterator）模式"><a href="#3-9-迭代器（Iterator）模式" class="headerlink" title="3.9 迭代器（Iterator）模式"></a>3.9 迭代器（Iterator）模式</h3><p>提供一个对象（迭代器）来顺序访问聚合对象（迭代数据）中的一系列数据，而不暴露聚合对象的内部表示。对象行为型模式</p>
<ul>
<li>抽象聚合（Aggregate）角色：定义存储、添加、删除聚合对象以及创建迭代器对象的接口。</li>
<li>具体聚合（ConcreteAggregate）角色：实现抽象聚合类，返回一个具体迭代器的实例。</li>
<li>抽象迭代器（Iterator）角色：定义访问和遍历聚合元素的接口，通常包含 hasNext()、first()、next() 等方法。</li>
<li>具体迭代器（Concretelterator）角色：实现抽象迭代器接口中所定义的方法，完成对聚合对象的遍历，记录遍历的当前位置。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221141857171.png" srcset="/img/loading.gif" lazyload alt="image-20211221141857171"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>jdk容器接口的Iterator定义</li>
<li>现实开发中，我们几乎无需编写迭代器，基本数据结构链表、树、图的迭代器已经都有了。除非要重写迭代逻辑</li>
</ul>
<h3 id="3-10-访问者（Visitor）模式"><a href="#3-10-访问者（Visitor）模式" class="headerlink" title="3.10 访问者（Visitor）模式"></a>3.10 访问者（Visitor）模式</h3><p>将作用于某种数据结构中的各元素的操作分离出来封装成独立的类，使其在不改变数据结构的前提下可以添加作用于这些元素的新的操作，为数据结构中的每个元素提供多种访问方式。它将对数据的操作与数据结构进行分离，是类行为模式中最复杂的一种模式</p>
<p><strong>主要角色</strong></p>
<ul>
<li>抽象访问者（Visitor）角色：定义一个访问具体元素的接口，为每个具体元素类对应一个访问操作 visit() ，该操作中的参数类型标识了被访问的具体元素。</li>
<li>具体访问者（ConcreteVisitor）角色：实现抽象访问者角色中声明的各个访问操作，确定访问者访问一个元素时该做什么。</li>
<li>抽象元素（Element）角色：声明一个包含接受操作 accept() 的接口，被接受的访问者对象作为 accept() 方法的参数。</li>
<li>具体元素（ConcreteElement）角色：实现抽象元素角色提供的 accept() 操作，其方法体通常都是 visitor.visit(this) ，另外具体元素中可能还包含本身业务逻辑的相关操作。</li>
<li>对象结构（Object Structure）角色：是一个包含元素角色的容器，提供让访问者对象遍历容器中的所有元素的方法，通常由 List、Set、Map 等聚合类实现。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221142741832.png" srcset="/img/loading.gif" lazyload alt="image-20211221142741832"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>在访问者模式中，每增加一个新的元素类，都要在每一个具体访问者类中增加相应的具体操作，这违背了开闭原则</li>
<li>违反<strong>依赖倒置原则</strong>。访问者模式依赖了具体类，而没有依赖抽象类</li>
<li>破坏封装。访问者模式中具体元素对访问者公开细节</li>
<li>应用于对象结构相对稳定，但其操作算法经常变化的程序</li>
<li>Spring反射工具中的MethodVisitor是什么？</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 硬件。      抽象元素类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span>  <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hardware</span> &#123;<br>    String command;<span class="hljs-comment">//封装硬件的处理指令</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Hardware</span><span class="hljs-params">(String command)</span>&#123;<br>        <span class="hljs-built_in">this</span>.command = command;<br>    &#125;<br><br>    <span class="hljs-comment">//收到命令以后进行工作</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">//定义接受软件升级包的方法。这个方法应该具体硬件去实现</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Vistor vistor)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CPU</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Hardware</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CPU</span><span class="hljs-params">(String command)</span> &#123;<br>        <span class="hljs-built_in">super</span>(command);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;CPU处理指令：&quot;</span>+command);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Vistor vistor)</span> &#123;<br>        <span class="hljs-comment">//给升级包提供一个改CPU指令等信息的办法</span><br>        vistor.visitCPU(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Disk</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Hardware</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Disk</span><span class="hljs-params">(String command)</span> &#123;<br>        <span class="hljs-built_in">super</span>(command);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Disk保存指令的历史记录：&quot;</span>+command);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Vistor vistor)</span> &#123;<br>        vistor.visitDisk(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>升级包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 升级包的接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Vistor</span> &#123;<br>    <span class="hljs-comment">//访问者能访问元素。</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitDisk</span><span class="hljs-params">(Disk disk)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitCPU</span><span class="hljs-params">(CPU cpu)</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 升级包可以更改指令</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdatePackage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Vistor</span>&#123;<br><br>    <span class="hljs-keyword">private</span> String ext;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-title function_">UpdatePackage</span><span class="hljs-params">(String ext)</span>&#123;<br>        <span class="hljs-built_in">this</span>.ext = ext;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitDisk</span><span class="hljs-params">(Disk disk)</span> &#123;<br>        disk.command += <span class="hljs-string">&quot; &gt;&gt;&gt; &quot;</span>+ext;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitCPU</span><span class="hljs-params">(CPU cpu)</span> &#123;<br>        <span class="hljs-comment">//改属性为例</span><br>        cpu.command += <span class="hljs-string">&quot;&gt;&gt;&gt;&gt; &quot;</span>+ext;<br>        <span class="hljs-comment">//装饰模式。改方法</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以理解为小爱机器人相对稳定，但是需要经常升级指令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 小爱机器人</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoAi</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">CPU</span> <span class="hljs-variable">cpu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CPU</span>(<span class="hljs-string">&quot;武汉天气&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Disk</span> <span class="hljs-variable">disk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Disk</span>(<span class="hljs-string">&quot;武汉天气&quot;</span>);<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">answerQuestion</span><span class="hljs-params">()</span>&#123;<br>        cpu.work();<br>        disk.work();<br>    &#125;<br><br>    <span class="hljs-comment">//接受升级包</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptUpdate</span><span class="hljs-params">(Vistor aPackage)</span> &#123;<br>        <span class="hljs-comment">//访问模式</span><br>        aPackage.visitCPU(cpu);<br>        aPackage.visitDisk(disk);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">XiaoAi</span> <span class="hljs-variable">xiaoAi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoAi</span>();<br>        xiaoAi.answerQuestion();<br>        <span class="hljs-comment">//升级。cpu联网处理指令</span><br>        <span class="hljs-comment">//升级。disk保存到云存储</span><br>        <span class="hljs-type">UpdatePackage</span> <span class="hljs-variable">aPackage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdatePackage</span>(<span class="hljs-string">&quot;联网增强功能&quot;</span>);<br>        xiaoAi.acceptUpdate(aPackage);<br>        <span class="hljs-comment">//访问者</span><br>        xiaoAi.answerQuestion();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-11-责任链（Chain-of-Responsibility）模式"><a href="#3-11-责任链（Chain-of-Responsibility）模式" class="headerlink" title="3.11 责任链（Chain of Responsibility）模式"></a>3.11 责任链（Chain of Responsibility）模式</h3><p>为了避免请求发送者与多个请求处理者耦合在一起，于是将所有请求的处理者通过前一对象记住其下一个对象的引用而连城一条链；当有请求发生时，可以将请求沿着这条链传递，直到有对象处理它为止</p>
<p><strong>主要角色</strong></p>
<ul>
<li>抽象处理者（Handler）角色：定义一个处理请求的接口，包含抽象处理方法和一个后继连接。</li>
<li>具体处理者（Concrete Handler）角色：实现抽象处理者的处理方法，判断能否处理本次请求，如果可以处理请求则处理，否则将该请求转给它的后继者。</li>
<li>客户类（Client）角色：创建处理链，并向链头的具体处理者对象提交请求，它不关心处理细节和请求的传递过程。</li>
</ul>
<p><img src="%E6%80%BB%E8%A7%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20211221143204328.png" srcset="/img/loading.gif" lazyload alt="image-20211221143204328"></p>
<p><strong>应用场景</strong></p>
<ul>
<li>Tomcat的Pipeline、Value</li>
<li>Filter链</li>
<li>Aop责任链</li>
</ul>
<p>自定义request和response</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Request</span> &#123;<br>    String msg; <span class="hljs-comment">//请求内容</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Request</span><span class="hljs-params">(String msg)</span>&#123;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Response</span> &#123;<br>    String content;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Response</span><span class="hljs-params">(String content)</span>&#123;<br>        <span class="hljs-built_in">this</span>.content = content;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>自定义过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(Request request,Response response,FilterChain chain)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CharacterFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(Request request, Response response, FilterChain chain)</span> &#123;<br>        <span class="hljs-comment">//功能</span><br>        request.msg +=<span class="hljs-string">&quot; ====&quot;</span>;<br>        System.out.println(<span class="hljs-string">&quot;CharacterFilter...doFilter之前&quot;</span>);<br>        <span class="hljs-comment">//放行</span><br>        chain.doFilter(request,response,chain);<br>        System.out.println(<span class="hljs-string">&quot;CharacterFilter...doFilter之后&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EncodingFilter</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(Request request, Response response, FilterChain chain)</span> &#123;<br>        request.msg+=<span class="hljs-string">&quot; oooo&quot;</span>;<br>        System.out.println(<span class="hljs-string">&quot;EncodingFilter...doFilter之前&quot;</span>);<br>        <span class="hljs-comment">//放行</span><br>        chain.doFilter(request,response,chain);<br>        System.out.println(<span class="hljs-string">&quot;EncodingFilter...doFilter之后&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(Request request, Response response, FilterChain chain)</span> &#123;<br>        <span class="hljs-comment">//第一个filter的功能</span><br>        request.msg+=<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>;<br>        System.out.println(<span class="hljs-string">&quot;HttpFilter...doFilter之前&quot;</span>);<br>        <span class="hljs-comment">//放行</span><br>        chain.doFilter(request,response,chain);<br>        System.out.println(<span class="hljs-string">&quot;HttpFilter...doFilter之后&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>自定义过滤链和目标执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 目标执行方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">My</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;调用my.hello()&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 靠他维护链条</span><br><span class="hljs-comment"> * HandlerExecutionChain</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterChain</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-comment">//记录当前执行的步骤</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//filter的链</span><br>    List&lt;Filter&gt; filtersChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//最终要执行的目标方法</span><br>    My target;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTarget</span><span class="hljs-params">(My target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> My <span class="hljs-title function_">getTarget</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> target;<br>    &#125;<br><br>    <span class="hljs-comment">//添加filter</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFilter</span><span class="hljs-params">(Filter filter)</span>&#123;<br>        filtersChain.add(filter);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(Request request, Response response, FilterChain chain)</span> &#123;<br>        <span class="hljs-comment">//第一次执行第一个filter，一次往下</span><br>        <span class="hljs-comment">//游标小于总数量filter一直往下获取执行</span><br>        <span class="hljs-keyword">if</span>(cursor &lt; filtersChain.size())&#123;<br>            <span class="hljs-type">Filter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> filtersChain.get(cursor);<br>            cursor++;<br>            <span class="hljs-comment">//执行filter</span><br>            filter.doFilter(request,response,chain);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//filter完了，该执行目标方法了</span><br>            target.hello();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1---2---3--my---3---2---1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">FilterChain</span> <span class="hljs-variable">chain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterChain</span>();<br><br>        <span class="hljs-comment">//web.xml =- filter</span><br>        <span class="hljs-type">HttpFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpFilter</span>();<br>        <span class="hljs-type">CharacterFilter</span> <span class="hljs-variable">characterFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CharacterFilter</span>();<br>        <span class="hljs-type">EncodingFilter</span> <span class="hljs-variable">encodingFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EncodingFilter</span>();<br>        chain.addFilter(filter);<br>        chain.addFilter(characterFilter);<br>        chain.addFilter(encodingFilter);<br><br>        chain.setTarget(<span class="hljs-keyword">new</span> <span class="hljs-title class_">My</span>());<br><br>        <span class="hljs-comment">//filter如何链式执行。</span><br><br>        chain.doFilter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>(<span class="hljs-string">&quot;hello world&quot;</span>),<br>                       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;adhkjasdhak&quot;</span>),chain);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="../../tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#设计模式</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>总览设计模式</div>
      <div>https://noaharno.top/设计模式/总览设计模式/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>NoahArno</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="../../Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Spring源码分析">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring源码分析</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="../../%E9%9D%A2%E8%AF%95%E8%AF%9D%E6%9C%AF/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="分布式系统理论知识">
                        <span class="hidden-mobile">分布式系统理论知识</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="../../js/events.js" ></script>
<script  src="../../js/plugins.js" ></script>





  
    <script  src="../../js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="../../js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="../../js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
