# 内存标记

在秒杀中，可以通过redis进行预减库存来减少与mysql的交互，但是当商品卖完之后，还是会有很多的请求跟redis进行交互，这就可以使用内存标记了。

准备一个map：

```java
private static final Map<Long, Boolean> emptyStock = new HashMap<>();

// 在进行redis初始预减库存的时候，设置为false
emptyStock.put(goodsVo.getId(), Boolean.FALSE);

// 当通过查询mysql查到已经没有库存的时候，设置为true
if(stock < 0){
    emptyStock.put(goodsId, Boolean.TRUE);
	…………
}

// 在请求进来的时候，就可以率先判断是否有库存了
// 内存标记，减少redis访问
if(emptyStock.get(goodsId)){
    return RespBean.error(RespBeanEnum.EMPTY_STOCK);
}
```

# 秒杀Jemter测试